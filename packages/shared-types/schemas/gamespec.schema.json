{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://promptplay.dev/schemas/gamespec.schema.json",
  "title": "PromptPlay GameSpec",
  "description": "Complete game specification for PromptPlay 2D game engine. This schema defines all entities, components, and configuration needed to create a playable game.",
  "type": "object",
  "required": ["version", "metadata", "config", "entities", "systems"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version for compatibility checking",
      "const": "1.0"
    },
    "metadata": {
      "$ref": "#/definitions/GameMetadata"
    },
    "config": {
      "$ref": "#/definitions/GameConfig"
    },
    "entities": {
      "type": "array",
      "description": "List of game entities. For single-scene games, all entities go here. For multi-scene games, use scenes array instead.",
      "items": {
        "$ref": "#/definitions/EntitySpec"
      }
    },
    "scenes": {
      "type": "array",
      "description": "Optional multi-scene support. When present, entities should be empty and each scene contains its own entities.",
      "items": {
        "$ref": "#/definitions/SceneSpec"
      }
    },
    "activeScene": {
      "type": "string",
      "description": "ID of the currently active scene (when using multi-scene)"
    },
    "systems": {
      "type": "array",
      "description": "List of active game systems",
      "items": {
        "type": "string",
        "enum": ["physics", "input", "collision", "render", "animation", "ai", "audio", "particles", "camera"]
      },
      "default": ["physics", "input", "collision", "render"]
    },
    "settings": {
      "$ref": "#/definitions/GameSettings"
    }
  },
  "definitions": {
    "GameMetadata": {
      "type": "object",
      "description": "Basic game information",
      "required": ["title", "genre", "description"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Display name of the game",
          "minLength": 1,
          "maxLength": 100,
          "examples": ["Super Platformer", "Space Shooter", "Puzzle Quest"]
        },
        "name": {
          "type": "string",
          "description": "Optional internal name (defaults to title)"
        },
        "genre": {
          "type": "string",
          "description": "Game genre determines default physics and gameplay patterns",
          "enum": ["platformer", "shooter", "puzzle"],
          "enumDescriptions": {
            "platformer": "Side-scrolling with gravity (gravity.y = 1). Jump mechanics, platforms, enemies.",
            "shooter": "Top-down or side-view. Zero gravity (gravity.y = 0). Projectiles, waves of enemies.",
            "puzzle": "Grid-based or physics puzzles. May have gravity depending on mechanics."
          }
        },
        "description": {
          "type": "string",
          "description": "Brief description of the game",
          "maxLength": 500
        }
      }
    },
    "GameConfig": {
      "type": "object",
      "description": "Global game configuration",
      "required": ["gravity", "worldBounds"],
      "properties": {
        "gravity": {
          "type": "object",
          "description": "World gravity. Platformers: {x:0, y:1}. Top-down: {x:0, y:0}",
          "required": ["x", "y"],
          "properties": {
            "x": {
              "type": "number",
              "description": "Horizontal gravity (usually 0)",
              "default": 0
            },
            "y": {
              "type": "number",
              "description": "Vertical gravity. 1 for platformers, 0 for top-down",
              "default": 1,
              "minimum": -10,
              "maximum": 10
            }
          }
        },
        "worldBounds": {
          "type": "object",
          "description": "Game world dimensions in pixels",
          "required": ["width", "height"],
          "properties": {
            "width": {
              "type": "number",
              "description": "World width in pixels",
              "default": 800,
              "minimum": 100,
              "maximum": 10000
            },
            "height": {
              "type": "number",
              "description": "World height in pixels",
              "default": 600,
              "minimum": 100,
              "maximum": 10000
            }
          }
        }
      }
    },
    "GameSettings": {
      "type": "object",
      "description": "Additional game settings",
      "properties": {
        "physics": {
          "type": "object",
          "properties": {
            "gravity": {
              "type": "number",
              "description": "Alternative gravity multiplier"
            },
            "friction": {
              "type": "number",
              "description": "Global friction coefficient",
              "minimum": 0,
              "maximum": 1
            }
          }
        }
      }
    },
    "SceneSpec": {
      "type": "object",
      "description": "A game scene/level containing entities",
      "required": ["id", "name", "entities"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique scene identifier",
          "pattern": "^[a-z][a-z0-9_]*$",
          "examples": ["main", "level_1", "boss_arena"]
        },
        "name": {
          "type": "string",
          "description": "Display name for the scene",
          "examples": ["Main Scene", "Level 1", "Boss Arena"]
        },
        "entities": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/EntitySpec"
          }
        },
        "config": {
          "type": "object",
          "description": "Scene-specific configuration overrides",
          "properties": {
            "gravity": {
              "type": "object",
              "properties": {
                "x": { "type": "number" },
                "y": { "type": "number" }
              }
            },
            "worldBounds": {
              "type": "object",
              "properties": {
                "width": { "type": "number" },
                "height": { "type": "number" }
              }
            },
            "backgroundColor": {
              "type": "string",
              "description": "Background color as hex string",
              "pattern": "^#[0-9a-fA-F]{6,8}$"
            }
          }
        }
      }
    },
    "EntitySpec": {
      "type": "object",
      "description": "A game entity with components",
      "required": ["name", "components"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique entity identifier within the scene",
          "pattern": "^[a-zA-Z][a-zA-Z0-9_-]*$",
          "examples": ["player", "enemy_1", "platform_ground", "coin_1"]
        },
        "components": {
          "$ref": "#/definitions/EntityComponents"
        },
        "tags": {
          "type": "array",
          "description": "Tags for grouping and querying entities",
          "items": {
            "type": "string",
            "enum": ["player", "enemy", "static", "platform", "collectible", "projectile", "trigger", "hazard", "checkpoint"],
            "enumDescriptions": {
              "player": "Player-controlled entity",
              "enemy": "Hostile entity",
              "static": "Immovable physics body (platforms, walls)",
              "platform": "Walkable surface",
              "collectible": "Can be collected by player",
              "projectile": "Moving attack object",
              "trigger": "Triggers events on collision",
              "hazard": "Damages player on contact",
              "checkpoint": "Save point"
            }
          },
          "examples": [["player"], ["enemy"], ["static", "platform"], ["collectible"]]
        }
      }
    },
    "EntityComponents": {
      "type": "object",
      "description": "Components attached to an entity. At minimum, most entities need transform and sprite.",
      "properties": {
        "transform": {
          "$ref": "#/definitions/TransformComponent"
        },
        "velocity": {
          "$ref": "#/definitions/VelocityComponent"
        },
        "sprite": {
          "$ref": "#/definitions/SpriteComponent"
        },
        "collider": {
          "$ref": "#/definitions/ColliderComponent"
        },
        "input": {
          "$ref": "#/definitions/InputComponent"
        },
        "health": {
          "$ref": "#/definitions/HealthComponent"
        },
        "aiBehavior": {
          "$ref": "#/definitions/AIBehaviorComponent"
        },
        "animation": {
          "$ref": "#/definitions/AnimationComponent"
        },
        "camera": {
          "$ref": "#/definitions/CameraComponent"
        },
        "particleEmitter": {
          "$ref": "#/definitions/ParticleEmitterComponent"
        },
        "audio": {
          "$ref": "#/definitions/AudioComponent"
        }
      }
    },
    "TransformComponent": {
      "type": "object",
      "description": "Position and orientation in 2D space. Required for all visible entities.",
      "required": ["x", "y"],
      "properties": {
        "x": {
          "type": "number",
          "description": "X position in pixels from left edge. Center of sprite.",
          "examples": [100, 400, 750]
        },
        "y": {
          "type": "number",
          "description": "Y position in pixels from top edge. Center of sprite. Note: Y increases downward.",
          "examples": [100, 300, 550]
        },
        "rotation": {
          "type": "number",
          "description": "Rotation in radians. 0 = no rotation, Math.PI = 180 degrees.",
          "default": 0,
          "minimum": -6.283185,
          "maximum": 6.283185
        },
        "scaleX": {
          "type": "number",
          "description": "Horizontal scale. 1 = 100%, 2 = 200%, -1 = flipped",
          "default": 1
        },
        "scaleY": {
          "type": "number",
          "description": "Vertical scale. 1 = 100%, 2 = 200%, -1 = flipped",
          "default": 1
        }
      }
    },
    "VelocityComponent": {
      "type": "object",
      "description": "Movement velocity for physics-enabled entities",
      "required": ["vx", "vy"],
      "properties": {
        "vx": {
          "type": "number",
          "description": "Horizontal velocity in pixels per second. Positive = right.",
          "default": 0,
          "examples": [0, 100, -50]
        },
        "vy": {
          "type": "number",
          "description": "Vertical velocity in pixels per second. Positive = down.",
          "default": 0,
          "examples": [0, -200, 100]
        }
      }
    },
    "SpriteComponent": {
      "type": "object",
      "description": "Visual appearance. Required for visible entities.",
      "required": ["texture", "width", "height"],
      "properties": {
        "texture": {
          "type": "string",
          "description": "Texture identifier. Use descriptive names like 'player', 'enemy', 'platform'. The engine will render colored rectangles if texture files don't exist.",
          "examples": ["player", "enemy", "platform", "coin", "bullet", "background"]
        },
        "width": {
          "type": "number",
          "description": "Display width in pixels",
          "minimum": 1,
          "maximum": 2000,
          "examples": [32, 48, 64, 100, 800]
        },
        "height": {
          "type": "number",
          "description": "Display height in pixels",
          "minimum": 1,
          "maximum": 2000,
          "examples": [32, 48, 64, 40, 600]
        },
        "tint": {
          "type": ["string", "number"],
          "description": "Color tint as hex string '#RRGGBBAA' or number 0xRRGGBBAA. Use for colored shapes when no texture.",
          "pattern": "^#[0-9a-fA-F]{6,8}$",
          "examples": ["#3498dbff", "#e74c3cff", "#2ecc71ff", "#f39c12ff", "#9b59b6ff"]
        },
        "visible": {
          "type": "boolean",
          "description": "Whether sprite is rendered",
          "default": true
        },
        "zIndex": {
          "type": "integer",
          "description": "Render order. Higher values render on top. Background: -100, Default: 0, UI: 100",
          "default": 0,
          "minimum": -1000,
          "maximum": 1000
        },
        "flipX": {
          "type": "boolean",
          "description": "Flip sprite horizontally",
          "default": false
        },
        "flipY": {
          "type": "boolean",
          "description": "Flip sprite vertically",
          "default": false
        },
        "frameX": {
          "type": "integer",
          "description": "X offset in sprite sheet (pixels)",
          "minimum": 0
        },
        "frameY": {
          "type": "integer",
          "description": "Y offset in sprite sheet (pixels)",
          "minimum": 0
        },
        "frameWidth": {
          "type": "integer",
          "description": "Width of single frame in sprite sheet",
          "minimum": 1
        },
        "frameHeight": {
          "type": "integer",
          "description": "Height of single frame in sprite sheet",
          "minimum": 1
        },
        "anchorX": {
          "type": "number",
          "description": "Horizontal anchor point (0-1). 0.5 = center",
          "default": 0.5,
          "minimum": 0,
          "maximum": 1
        },
        "anchorY": {
          "type": "number",
          "description": "Vertical anchor point (0-1). 0.5 = center",
          "default": 0.5,
          "minimum": 0,
          "maximum": 1
        }
      }
    },
    "ColliderComponent": {
      "type": "object",
      "description": "Physics collision shape. Add to entities that should collide or detect collisions.",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Collider shape type",
          "enum": ["box", "circle"],
          "enumDescriptions": {
            "box": "Rectangular collider. Use width and height.",
            "circle": "Circular collider. Use radius."
          }
        },
        "width": {
          "type": "number",
          "description": "Box collider width (required if type is 'box')",
          "minimum": 1,
          "examples": [32, 48, 64, 100]
        },
        "height": {
          "type": "number",
          "description": "Box collider height (required if type is 'box')",
          "minimum": 1,
          "examples": [32, 48, 64, 40]
        },
        "radius": {
          "type": "number",
          "description": "Circle collider radius (required if type is 'circle')",
          "minimum": 1,
          "examples": [16, 24, 32]
        },
        "isSensor": {
          "type": "boolean",
          "description": "If true, detects collisions but doesn't cause physical response. Use for triggers, collectibles.",
          "default": false
        },
        "layer": {
          "type": "integer",
          "description": "Collision layer for filtering which entities collide",
          "default": 0,
          "minimum": 0,
          "maximum": 31
        }
      },
      "if": {
        "properties": { "type": { "const": "box" } }
      },
      "then": {
        "required": ["type", "width", "height"]
      },
      "else": {
        "required": ["type", "radius"]
      }
    },
    "InputComponent": {
      "type": "object",
      "description": "Player input handling. Add to player-controlled entities.",
      "required": ["moveSpeed", "jumpForce"],
      "properties": {
        "moveSpeed": {
          "type": "number",
          "description": "Horizontal movement speed in pixels per second",
          "minimum": 0,
          "maximum": 1000,
          "default": 200,
          "examples": [150, 200, 300]
        },
        "jumpForce": {
          "type": "number",
          "description": "Jump impulse strength. Higher = higher jump. Set to 0 for no jump.",
          "minimum": 0,
          "maximum": 1000,
          "default": 400,
          "examples": [0, 300, 400, 500]
        },
        "canJump": {
          "type": "boolean",
          "description": "Whether jumping is enabled",
          "default": true
        },
        "keys": {
          "type": "object",
          "description": "Custom key bindings (optional)",
          "properties": {
            "left": {
              "type": "string",
              "description": "Key code for left movement",
              "default": "ArrowLeft",
              "examples": ["ArrowLeft", "KeyA"]
            },
            "right": {
              "type": "string",
              "description": "Key code for right movement",
              "default": "ArrowRight",
              "examples": ["ArrowRight", "KeyD"]
            },
            "jump": {
              "type": "string",
              "description": "Key code for jump",
              "default": "Space",
              "examples": ["Space", "ArrowUp", "KeyW"]
            }
          }
        }
      }
    },
    "HealthComponent": {
      "type": "object",
      "description": "Health tracking for damageable entities",
      "required": ["current", "max"],
      "properties": {
        "current": {
          "type": "number",
          "description": "Current health points",
          "minimum": 0,
          "examples": [100, 50, 3]
        },
        "max": {
          "type": "number",
          "description": "Maximum health points",
          "minimum": 1,
          "examples": [100, 50, 3]
        }
      }
    },
    "AIBehaviorComponent": {
      "type": "object",
      "description": "Enemy AI behavior patterns",
      "required": ["type", "speed", "detectionRadius"],
      "properties": {
        "type": {
          "type": "string",
          "description": "AI behavior pattern",
          "enum": ["patrol", "chase", "flee"],
          "enumDescriptions": {
            "patrol": "Move back and forth within patrolRange",
            "chase": "Follow player when within detectionRadius",
            "flee": "Run away from player when within detectionRadius"
          }
        },
        "speed": {
          "type": "number",
          "description": "Movement speed in pixels per second",
          "minimum": 0,
          "maximum": 500,
          "examples": [50, 100, 150]
        },
        "detectionRadius": {
          "type": "number",
          "description": "Distance to detect player (pixels)",
          "minimum": 0,
          "maximum": 1000,
          "examples": [100, 150, 200, 300]
        },
        "targetEntity": {
          "type": "integer",
          "description": "Entity ID to target (usually set at runtime)"
        },
        "patrolRange": {
          "type": "number",
          "description": "Distance to patrol from starting position (for patrol type)",
          "minimum": 0,
          "examples": [100, 150, 200]
        }
      }
    },
    "AnimationComponent": {
      "type": "object",
      "description": "Sprite animation configuration",
      "required": ["frameCount", "frameDuration"],
      "properties": {
        "currentFrame": {
          "type": "integer",
          "description": "Current animation frame index",
          "default": 0,
          "minimum": 0
        },
        "frameCount": {
          "type": "integer",
          "description": "Total number of frames in animation",
          "minimum": 1,
          "examples": [4, 8, 12]
        },
        "frameDuration": {
          "type": "number",
          "description": "Duration of each frame in milliseconds",
          "minimum": 1,
          "examples": [100, 150, 200]
        },
        "isPlaying": {
          "type": "boolean",
          "description": "Whether animation is currently playing",
          "default": true
        },
        "loop": {
          "type": "boolean",
          "description": "Whether animation loops",
          "default": true
        },
        "animationId": {
          "type": "integer",
          "description": "ID for switching between multiple animations"
        },
        "spriteSheet": {
          "type": "string",
          "description": "Path to sprite sheet image file",
          "examples": ["player-walk.png", "enemy-idle.png"]
        },
        "frameWidth": {
          "type": "integer",
          "description": "Width of single frame in sprite sheet",
          "minimum": 1
        },
        "frameHeight": {
          "type": "integer",
          "description": "Height of single frame in sprite sheet",
          "minimum": 1
        },
        "currentState": {
          "type": "string",
          "description": "Current animation state name",
          "examples": ["idle", "walk", "jump", "attack"]
        },
        "states": {
          "type": "array",
          "description": "Animation state machine states",
          "items": {
            "$ref": "#/definitions/AnimationState"
          }
        }
      }
    },
    "AnimationState": {
      "type": "object",
      "description": "A named animation state in the state machine",
      "required": ["name", "frameStart", "frameEnd", "frameDuration", "loop"],
      "properties": {
        "name": {
          "type": "string",
          "description": "State name for reference",
          "examples": ["idle", "walk", "run", "jump", "fall", "attack"]
        },
        "frameStart": {
          "type": "integer",
          "description": "Starting frame index in sprite sheet",
          "minimum": 0
        },
        "frameEnd": {
          "type": "integer",
          "description": "Ending frame index in sprite sheet",
          "minimum": 0
        },
        "frameDuration": {
          "type": "number",
          "description": "Duration per frame in milliseconds",
          "minimum": 1
        },
        "loop": {
          "type": "boolean",
          "description": "Whether this state loops"
        },
        "transitions": {
          "type": "array",
          "description": "Automatic transitions to other states",
          "items": {
            "type": "object",
            "required": ["to", "condition"],
            "properties": {
              "to": {
                "type": "string",
                "description": "Target state name"
              },
              "condition": {
                "type": "object",
                "required": ["type"],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": ["immediate", "onComplete", "parameter"]
                  },
                  "parameter": { "type": "string" },
                  "comparator": {
                    "type": "string",
                    "enum": ["==", "!=", ">", "<", ">=", "<="]
                  },
                  "value": {}
                }
              }
            }
          }
        }
      }
    },
    "CameraComponent": {
      "type": "object",
      "description": "Camera configuration for viewport control",
      "properties": {
        "offsetX": {
          "type": "number",
          "description": "Camera X offset from target",
          "default": 0
        },
        "offsetY": {
          "type": "number",
          "description": "Camera Y offset from target (negative = above)",
          "default": 0,
          "examples": [0, -50, -100]
        },
        "zoom": {
          "type": "number",
          "description": "Zoom level. 1 = 100%, 2 = 200%",
          "default": 1,
          "minimum": 0.1,
          "maximum": 10
        },
        "followTarget": {
          "type": "integer",
          "description": "Entity ID to follow (set at runtime)"
        },
        "followSmoothing": {
          "type": "number",
          "description": "Follow interpolation. 0 = instant, 1 = very slow",
          "default": 0.1,
          "minimum": 0,
          "maximum": 1
        },
        "viewportWidth": {
          "type": "number",
          "description": "Viewport width in pixels"
        },
        "viewportHeight": {
          "type": "number",
          "description": "Viewport height in pixels"
        },
        "shakeIntensity": {
          "type": "number",
          "description": "Screen shake intensity (set at runtime)",
          "default": 0
        },
        "shakeDuration": {
          "type": "number",
          "description": "Screen shake duration remaining (set at runtime)",
          "default": 0
        },
        "isActive": {
          "type": "boolean",
          "description": "Whether this camera is the active camera",
          "default": true
        }
      }
    },
    "ParticleEmitterComponent": {
      "type": "object",
      "description": "Particle effect emitter configuration",
      "properties": {
        "emitRate": {
          "type": "number",
          "description": "Particles emitted per second",
          "default": 10,
          "minimum": 0,
          "examples": [5, 10, 50, 100]
        },
        "maxParticles": {
          "type": "integer",
          "description": "Maximum simultaneous particles",
          "default": 100,
          "minimum": 1,
          "maximum": 1000
        },
        "minLifetime": {
          "type": "number",
          "description": "Minimum particle lifetime in seconds",
          "default": 0.5,
          "minimum": 0
        },
        "maxLifetime": {
          "type": "number",
          "description": "Maximum particle lifetime in seconds",
          "default": 2,
          "minimum": 0
        },
        "minSize": {
          "type": "number",
          "description": "Minimum particle size in pixels",
          "default": 2,
          "minimum": 0.1
        },
        "maxSize": {
          "type": "number",
          "description": "Maximum particle size in pixels",
          "default": 8,
          "minimum": 0.1
        },
        "minSpeed": {
          "type": "number",
          "description": "Minimum emission speed",
          "default": 50,
          "minimum": 0
        },
        "maxSpeed": {
          "type": "number",
          "description": "Maximum emission speed",
          "default": 150,
          "minimum": 0
        },
        "minAngle": {
          "type": "number",
          "description": "Minimum emission angle in radians",
          "default": 0
        },
        "maxAngle": {
          "type": "number",
          "description": "Maximum emission angle in radians",
          "default": 6.283185
        },
        "startColor": {
          "type": ["string", "number"],
          "description": "Particle start color (hex string or number)",
          "examples": ["#ffcc00ff", "#ff6600ff"]
        },
        "endColor": {
          "type": ["string", "number"],
          "description": "Particle end color (fades to this)",
          "examples": ["#ff000000", "#00000000"]
        },
        "gravityX": {
          "type": "number",
          "description": "Particle gravity X",
          "default": 0
        },
        "gravityY": {
          "type": "number",
          "description": "Particle gravity Y",
          "default": 100
        },
        "isEmitting": {
          "type": "boolean",
          "description": "Whether actively emitting",
          "default": true
        },
        "burstCount": {
          "type": "integer",
          "description": "Number of particles in a burst",
          "minimum": 0
        }
      }
    },
    "AudioComponent": {
      "type": "object",
      "description": "Sound playback configuration",
      "required": ["source"],
      "properties": {
        "source": {
          "type": "string",
          "description": "Audio file path or identifier",
          "examples": ["jump.wav", "coin.mp3", "music.ogg"]
        },
        "volume": {
          "type": "number",
          "description": "Volume level 0-1",
          "default": 1,
          "minimum": 0,
          "maximum": 1
        },
        "pitch": {
          "type": "number",
          "description": "Playback speed/pitch multiplier",
          "default": 1,
          "minimum": 0.1,
          "maximum": 4
        },
        "isPlaying": {
          "type": "boolean",
          "description": "Whether audio is currently playing",
          "default": false
        },
        "loop": {
          "type": "boolean",
          "description": "Whether to loop playback",
          "default": false
        },
        "spatial": {
          "type": "boolean",
          "description": "Enable positional/3D audio",
          "default": false
        },
        "maxDistance": {
          "type": "number",
          "description": "Maximum distance for spatial audio",
          "default": 500
        }
      }
    }
  },
  "examples": [
    {
      "version": "1.0",
      "metadata": {
        "title": "Simple Platformer",
        "genre": "platformer",
        "description": "A basic platformer game"
      },
      "config": {
        "gravity": { "x": 0, "y": 1 },
        "worldBounds": { "width": 800, "height": 600 }
      },
      "entities": [
        {
          "name": "player",
          "components": {
            "transform": { "x": 100, "y": 400 },
            "sprite": { "texture": "player", "width": 32, "height": 48, "tint": "#3498dbff" },
            "collider": { "type": "box", "width": 32, "height": 48 },
            "input": { "moveSpeed": 200, "jumpForce": 400, "canJump": true },
            "health": { "current": 100, "max": 100 }
          },
          "tags": ["player"]
        },
        {
          "name": "ground",
          "components": {
            "transform": { "x": 400, "y": 580 },
            "sprite": { "texture": "platform", "width": 800, "height": 40, "tint": "#2c3e50ff" },
            "collider": { "type": "box", "width": 800, "height": 40 }
          },
          "tags": ["static", "platform"]
        }
      ],
      "systems": ["physics", "input", "collision", "render"]
    }
  ]
}
